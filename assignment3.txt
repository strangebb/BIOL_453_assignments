---
title: "Assignment 3 Univariate Models"
author: "James Strange"
date: "January 31, 2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
trees = read.csv('./data/treedata_subset.csv')
```

1.) Develop and compare models for species cover for Acer rubrum and Abies fraseri. Compare p-values you observe using the function anova() to those using summary(). For each species address the following additional questions:
-How well does the exploratory model appear to explain cover?
-Which explanatory variables are the most important?
-Do model diagnostics indicate any problems with violations of OLS assumptions?
-Are you able to explain variance in one species better than another, why might this be the case? 

*Initial graphical analysis of the data yields several observations and visible trends. First, the graph depicting the relationship between plot elevation and species abundance reveals that the plots up until rougly 1500 meters elevation are mostly inhabited by Acer rubrum, while the plots above 1500 meters elevation are mostly inhabited by Abies fraseri. Second, the boxblots depicting the relationship between the categorical variable "disturbance" and the level of species abundance in each plot reveals that while Acer rubrum has an abundance of roughly ~50% in each disturbance treatment, Abies fraseri shows a much more varied distribution of abundance with the highest occurring in the Virgin disturbance treatment.

```{r, include=FALSE}
trees$species == "Acer rubrum"
rubrum <- trees[trees$species == "Acer rubrum",]
trees$species == "Abies fraseri"
fraseri <- trees[trees$species == "Abies fraseri",]
library(ggplot2)
library(gridExtra)
library(scatterplot3d)
library(MASS)
```


ELEVATION MODELS


```{r}
rubrum_elev_mod = lm(cover ~ elev, data = rubrum)
fraseri_elev_mod = lm(cover ~ elev, data = fraseri)
par(mfrow=c(1,2))
plot(cover ~ elev, data = rubrum, xlab = 'Plot Elevation (m)',ylab = 'Abundance', main = 'Acer rubrum')
abline(rubrum_elev_mod)

plot(cover ~ elev, data = fraseri, 
     xlab = 'Plot Elevation (m)', ylab = 'Abundance', main = 'Abies fraseri')
abline(fraseri_elev_mod)

```

```{r}
plot(cover ~ elev, data = trees, type = 'n', 
     xlab = 'Plot Elevation (m)', ylab = 'Abundance')
points(cover ~ elev, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
lines(lowess(trees$elev[trees$species == 'Acer rubrum'],
             trees$cover[trees$species == 'Acer rubrum']),
      lty = 1, col = 'red')
points(cover ~ elev, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
lines(lowess(trees$elev[trees$species == 'Abies fraseri'],
             trees$cover[trees$species == 'Abies fraseri']),
      lty = 2, col = 'blue')
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), lty = c(1, 2), bty = 'n')

ggplot(data = rubrum, mapping = aes(x = elev, y = cover)) + 
  labs(title = 'Acer rubrum Plot Elevation (m) vs. Abundance', x = 'Plot Elevation (m)', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "red") +
    theme_classic() 
ggplot(data = fraseri, mapping = aes(x = elev, y = cover)) + 
  labs(title = 'Abies fraseri Plot Elevation (m) vs. Abundance', x = 'Plot Elevation (m)', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "blue") +
    theme_classic()

```

```{r}
summary(rubrum_elev_mod)
anova(rubrum_elev_mod)
```

Both tests gives similar p-values with statistical significance but only ~1% variance explained  

```{r}
summary(fraseri_elev_mod)
anova(fraseri_elev_mod)
```

Both tests give similar p-values with statistical significance and with ~48% variance explained. 

Thus, the fraseri_elev model is able to better explain fraseri abundance while the rubrum_elev model is not able to explain rubrum abundance to the same extent. 





STREAMDIST MODELS


```{r}
rubrum_streamdist_mod = lm(cover ~ streamdist, data = rubrum)
fraseri_streamdist_mod = lm(cover ~ streamdist, data = fraseri)
plot(cover ~ streamdist, data = trees, type = 'n', 
     xlab = 'Distance to Nearest Stream (m)', ylab = 'Abundance')
points(cover ~ streamdist, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
abline(rubrum_streamdist_mod)
points(cover ~ streamdist, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
abline(fraseri_streamdist_mod)
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), bty = 'n')

```

```{r}
plot(cover ~ streamdist, data = trees, type = 'n', 
     xlab = 'Nearest Stream Distance (m)', ylab = 'Abundance')
points(cover ~ streamdist, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
lines(lowess(trees$streamdist[trees$species == 'Acer rubrum'],
             trees$cover[trees$species == 'Acer rubrum']),
      lty = 1, col = 'red')
points(cover ~ streamdist, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
lines(lowess(trees$streamdist[trees$species == 'Abies fraseri'],
             trees$cover[trees$species == 'Abies fraseri']),
      lty = 2, col = 'blue')
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), lty = c(1, 2), bty = 'n')

ggplot(data = rubrum, mapping = aes(x = streamdist, y = cover)) + 
  labs(title = 'Acer rubrum Stream Distance (m) vs. Abundance', x = 'Nearest Stream Distance (m)', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "red") +
    theme_classic() 
ggplot(data = fraseri, mapping = aes(x = streamdist, y = cover)) + 
  labs(title = 'Abies fraseri Stream Distance (m) vs. Abundance', x = 'Nearest Stream Distance (m)', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "blue") +
    theme_classic()

```


```{r}
summary(rubrum_streamdist_mod)
anova(rubrum_streamdist_mod)
```

```{r}
summary(fraseri_streamdist_mod)
anova(fraseri_streamdist_mod)
```



For the rubrum_streamdist model, the summary and Anova functions indicate a p-value of ~0.01 but with only ~0.8% variance explained. Similarly, the fraseri_streamdist model gives a p-value of 0.04 with only ~9% variance explained. Therefore, the stream distance models do not do a good job of explaining cover for either species.



HEAT LOAD INDEX MODELS

```{r}
rubrum_beers_mod = lm(cover ~ beers, data = rubrum)
fraseri_beers_mod = lm(cover ~ beers, data = fraseri)
plot(cover ~ beers, data = trees, type = 'n', 
     xlab = 'Heat Load Index', ylab = 'Abundance')
points(cover ~ beers, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
abline(rubrum_beers_mod)
points(cover ~ beers, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
abline(fraseri_beers_mod)
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), bty = 'n')
```
```{r}
plot(cover ~ beers, data = trees, type = 'n', 
     xlab = 'Heat Load Index', ylab = 'Abundance')
points(cover ~ beers, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
lines(lowess(trees$beers[trees$species == 'Acer rubrum'],
             trees$cover[trees$species == 'Acer rubrum']),
      lty = 1, col = 'red')
points(cover ~ beers, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
lines(lowess(trees$beers[trees$species == 'Abies fraseri'],
             trees$cover[trees$species == 'Abies fraseri']),
      lty = 2, col = 'blue')
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), lty = c(1, 2), bty = 'n')

ggplot(data = rubrum, mapping = aes(x = beers, y = cover)) + 
  labs(title = 'Acer rubrum Heat Load Index vs. Abundance', x = 'Heat Load Index', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "red") +
    theme_classic() 
ggplot(data = fraseri, mapping = aes(x = beers, y = cover)) + 
  labs(title = 'Abies fraseri Heat Load Index vs. Abundance', x = 'Heat Load Index', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "blue") +
    theme_classic()

```

```{r}
summary(rubrum_beers_mod)
anova(rubrum_beers_mod)
summary(fraseri_beers_mod)
anova(fraseri_beers_mod)
```

For the rubrum_beers model, a p-value of ~0.001 is given with only ~1.4% analysis explained. For the fraseri_beers model, a p-value of ~0.23 is given with only ~3% of variance explained. Thus, this model does not sufficiently account for coverage variance in either species. 




SITE WATER POTENTIAL MODELS

```{r}
rubrum_tci_mod = lm(cover ~ tci, data = rubrum)
fraseri_tci_mod = lm(cover ~ tci, data = fraseri)
plot(cover ~ tci, data = trees, type = 'n', 
     xlab = 'Site Water Potential', ylab = 'Abundance')
points(cover ~ tci, data = trees, subset = species == "Acer rubrum",
       pch = 1, col = 'red')
abline(rubrum_tci_mod)
points(cover ~ tci, data = trees, subset = species == "Abies fraseri",
       pch = 2, col = 'blue')
abline(fraseri_tci_mod)
legend('topleft', c('Acer rubrum', 'Abies fraseri'), col = c('red', 'blue'), 
       pch = c(1, 2), bty = 'n')
ggplot(data = rubrum, mapping = aes(x = tci, y = cover)) + 
  labs(title = 'Acer rubrum Water Potential vs. Abundance', x = 'Water Potential', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "red") +
    theme_classic() 
ggplot(data = fraseri, mapping = aes(x = tci, y = cover)) + 
  labs(title = 'Abies fraseri Water Potential vs. Abundance', x = 'Water Potential', y = "Abundance") + 
  geom_point(mapping = aes(color = species)) +
    geom_smooth(mapping = aes(linetype = species, color = species), method = 'loess') +
    scale_color_manual(values = "blue") +
    theme_classic()
```

```{r}
summary(rubrum_tci_mod)
anova(rubrum_tci_mod)
summary(fraseri_tci_mod)
anova(fraseri_tci_mod)
```


For the rubrum_tci model, a p-value of ~0.08 is given with ~0.4% variance explained. For the fraseri_tci model, a p-value of ~0.67 is given with ~0.4% variance explained, meaning neither model sufficiently explaines the coverage variance of their respective species. 


COMBINED MODELS

```{r}
rubrum_main_mod = lm(cover ~ elev + beers + tci + streamdist + disturb, data = rubrum)
summary(rubrum_main_mod)
anova(rubrum_main_mod)
```

With a combined Acer rubrum model, the anova test suggests that elev, beers, tci, and streamdist are statistically significant, but with only ~4% variance explained. Thus, despite the statistical significance, these variables are not able to sufficiently account for variance of the A. rubrum abundance.  

 
```{r}
fraseri_main_mod = lm(cover ~ elev + beers + tci + streamdist + disturb, data = fraseri)
summary(fraseri_main_mod)
anova(fraseri_main_mod)
```

The Abies fraseri combined model shows a different story. Here, the elev variable is statistically significant with ~58% variance explained. Thus, the elevation variable is the best predictor of A. fraseri abundance. 



*MODEL DIAGNOSTICS*


```{r}
AIC(rubrum_elev_mod)
AIC(rubrum_beers_mod)
AIC(rubrum_streamdist_mod)
AIC(rubrum_tci_mod)
AIC(rubrum_disturb_mod)
AIC(rubrum_main_mod)
```

```{r}
rubrum_ebs_mod = lm(cover ~ elev + beers + streamdist, data = rubrum)
AIC(rubrum_ebs_mod)
```

Of the models listed above, the Acer rubrum combined main model and the Acer rubrum model with isolated elev, beers, and streamdist model yield the lowest AIC values and are therefore the best models.


```{r}
par(mfrow = c(2,2))
plot(rubrum_main_mod)
```

```{r}
par(mfrow = c(2,2))
plot(rubrum_ebs_mod)
```

For both Acer rubrum models, the diagnostics suggest that the assumption of homoscadisticity does not hold and outliers are present, but the assumption of normal distribution is preserved. 

```{r}
AIC(fraseri_elev_mod)
AIC(fraseri_beers_mod)
AIC(fraseri_streamdist_mod)
AIC(fraseri_tci_mod)
AIC(fraseri_disturb_mod)
AIC(fraseri_main_mod)
```

Here, the Abies fraseri model accounting for the elevation variable alone yields the lowest AIC value and is therefore the best model.

```{r}
par(mfrow = c(2,2))
plot(fraseri_elev_mod)
```

Model diagnostics of the A. fraseri elevation model reveal that the assumptions of homoscadisticity, normal distribution, and lack of outliers are conserved.

**Although the Acer rubrum model for all variables and the model for only elev, beers, and streamdist are able to achieve statistical relevance, their relatively small % of variance explained means that they are not able to adequately account for variance in the abundance cover variable. However, the statistical significance and ~50% of variance explained for the Abies fraseri elevation model means that it is more able to account for variance in the A. fraseri abundance (cover) variable. Since Acer rubrum is a habitat generalist, it would make sense that the presented variables are not able to sufficiently explain the distribution of A. rubrum abundance since the species is able to thrive in a wide range of habitat conditions. Furthermore, since Abies fraseri is a habitat specialist, it would make sense that only one of the variables (plot elevation) is able to best explain the variance in A. fraseri abundance distribution since the species is only able to thrive in a narrow range of habitat conditions and plot altitudes.






